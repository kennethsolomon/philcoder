<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>PhilipCoder | Browse Courses</title>

  <!-- update the version number as needed -->
  <script defer src="/__/firebase/5.3.1/firebase-app.js"></script>
  <!-- include only the Firebase features as you need -->
  <script defer src="/__/firebase/5.3.1/firebase-auth.js"></script>
  <script defer src="/__/firebase/5.3.1/firebase-database.js"></script>
  <script defer src="/__/firebase/5.3.1/firebase-messaging.js"></script>
  <script defer src="/__/firebase/5.3.1/firebase-storage.js"></script>
  <!-- initialize the SDK after all desired features are loaded -->
  <script defer src="/__/firebase/init.js"></script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>

  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

  <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
  <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>

  <!-- bootstrap css -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">

  <!-- Material Design -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
  <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>

  <!-- my custom design -->
  <link rel="stylesheet" href="assets/css/custom.css"/>
</head>
<body>

  <nav class="navbar navbar-expand-lg navbar-dark" style="background-color: #4257b2;">
    <a class="navbar-brand" href="#" style="font-size: 26px; margin-left: 15px;"><b>PhilipCoder</b></a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto">
        <!--<li></li>
            <li class="nav-item active">
              <a class="nav-link" href="https://philipcoder.firebaseapp.com/home.html">Home <span class="sr-only">(current)</span></a>
        </li>-->
        <li class="nav-item active">
          <a class="nav-link" href="/course.html">Browse Courses <span class="sr-only">(current)</span></a>
        </li>
        <!--<li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Dropdown
          </a>
          <div class="dropdown-menu" aria-labelledby="navbarDropdown">
            <a class="dropdown-item" href="#">Action</a>
            <a class="dropdown-item" href="#">Another action</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="#">Something else here</a>
          </div>
        </li>
        <li class="nav-item">
          <a class="nav-link disabled" href="#">Disabled</a>
          </li>-->
      </ul>
      <!-- Expandable Textfield -->
          <form action="#" style="margin-right: 20px;">
            <div class="mdl-textfield mdl-js-textfield mdl-textfield--expandable">
              <label class="mdl-button mdl-js-button mdl-button--icon" for="sample6">
                <i class="material-icons" style="color: white;">search</i>
              </label>
              <div class="mdl-textfield__expandable-holder">
                <input class="mdl-textfield__input" type="text" id="sample6">
                <label class="mdl-textfield__label" for="sample-expandable">Expandable Input</label>
              </div>
            </div>
          </form>

      <!--<a href="#" class="nav-link">Log in</a>-->
      <form class="form-inline my-2 my-lg-0">
        <!--<input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
        <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect" type="button" style="background-color: gold;" data-toggle="modal" data-target="#regmodal">
            Sign up
          </button>-->
          <button type="button" class="btn btn-warning" style="padding: 15px; margin-right: 25px;">Complete purchase</button>
      </form>

      <!-- Large button groups (default and split) -->
      <div class="btn-group">
          <a href="#" id="usermenu-dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <!--<img src="https://s6.postimg.cc/4p3bwfyzl/babako.jpg" style="width:40px; height: 40px; border-radius: 50%; margin-right: 8px;"/>
              Jessica Ernacio
              <i class="material-icons">arrow_drop_down</i>-->
          </a>
          <div class="dropdown-menu dropdown-menu-right" style="border-radius: 0px;">
            <a class="dropdown-item" href="/mycourse.html">My Courses</a>
            <a id="btnsignout" class="dropdown-item" href="#">Log out</a>
          </div>
      </div>

    </div>
  </nav>

  <div class="container">
      <div class="row" style="padding-top: 20px;">
          <div class="col-md-12">
            <h3 style="color: gray;">Courses Offered</h3>
            <div class="flex-container" id="course-container">
              <!--<button class="add-class" id="show-dialog" type="button">
                  <i class="material-icons" style="font-size:80px; padding: 38%; color: gainsboro;">add</i>
              </button>-->
               <!--Content Here-->
            </div>
          </div>
      </div>
  </div>

  <!--<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>

  <!-- included javascript -->
  <script src="assets/javascript/user_manager.js"></script>
  <script defer src="assets/javascript/course_manager.js"></script>

 <script>
    document.addEventListener('DOMContentLoaded', function() {
      try {
        let app = firebase.app();
        let features = ['auth', 'database', 'messaging', 'storage'].filter(feature => typeof app[feature] === 'function');
        
        var provider = new firebase.auth.GoogleAuthProvider();
        var theUser = null;
        // Note this call is async too! It will be called with the correct user later.
        firebase.auth().onAuthStateChanged(user => {
          if (user) {
            // the firebase user object is documented here:
            // https://firebase.google.com/docs/reference/js/firebase.User
            theUser = user; // you will see theUser below

            //console.log(user);

            // Wait for the user to log in before we show the course table
            new UserManager(theUser);

            // User is signed in.
            var displayName = user.displayName;
            var email = user.email;
            var emailVerified = user.emailVerified;
            var photoURL = user.photoURL;
            var isAnonymous = user.isAnonymous;
            var uid = user.uid;
            var providerData = user.providerData;

            if(displayName){
                $("#usermenu-dropdown").html('<img src="'+photoURL+'" style="width:40px; height: 40px; border-radius: 50%; margin-right: 8px;"/>'+displayName+'<i class="material-icons">arrow_drop_down</i>');
            }else{
                $("#usermenu-dropdown").html('<img src="'+photoURL+'" style="width:40px; height: 40px; border-radius: 50%; margin-right: 8px;"/>'+email+'<i class="material-icons">arrow_drop_down</i>');
            }
            //showcourses();
            showYourCourses(theUser);
            // ...
          }else{
            // User is signed out.
            // ...
            location.href = "index.html";
          }
        });

        // We don't want to call this now. We want to show marketing content and
        // wait for the user to press the login button!
        //firebase.auth().signInWithPopup(provider);

      } catch (e) {
        console.error(e);
        $('#load').text('Error loading the Firebase SDK, check the console.');
      }
    });

    /*function showcourses(){
      var usercourseRef = firebase.database().ref('course/');
      usercourseRef.once('value', (snapshot) => {
        snapshot.forEach((childSnapshot)=> {
          var userid = childSnapshot.key;
          
          let coursesRef = usercourseRef.child(userid);
          console.log(userid);
          coursesRef.once('value', (snapcourses) => {
            console.log(snapcourses.val());          
            snapcourses.forEach((childSnapshot)=> {
              var courseid = childSnapshot.key;
              var course = childSnapshot.val();
              insertCourseInTable(courseid, course);
            });
          });
        });
      });
    }*/
    
    function showYourCourses(theUser){
      var courseRef = firebase.database().ref('course/' + theUser.uid);
      courseRef.once('value', (snapshot) => {
        if(snapshot){
          let courses = snapshot.val();
          for (let id in courses) {
            let course = courses[id];
            this.insertCourseInTable(id, course);
          }
        }
      });
    }

    function insertCourseInTable(id, course) {
      var list = $('.flex-container').append(
        `<div class="demo-card-square mdl-card mdl-shadow--2dp" id="courseid_${id}">
            <div class="mdl-card__title mdl-card--expand" style="background: url('${ course.imageurl }'); background-position: center; background-repeat: no-repeat; background-size: cover;">
                <h2 class="mdl-card__title-text course-title">${ course.title }</h2>
            </div>
            <div class="mdl-card__supporting-text course-des">
            ${ course.description }
            </div>
            <div class="mdl-card__actions mdl-card--border">
                <a href="/vcourse.html?courseid=${id}" class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect take-course">
                    Start
                </a>
            </div>
        </div>`);
    }
  </script>
</body>

</html>
